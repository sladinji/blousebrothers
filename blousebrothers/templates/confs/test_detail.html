{% extends "layout.html" %}
{% load static %}
{% load i18n %}
{% load youtube %}
{% load bbtricks %}
{% load cropping %}

{% block title %}{{ object.conf.title}}{% endblock %}

{% block submenu %}
      <a class="btn" href="{% url 'confs:edit' object.conf.slug %}"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Editer la conférence</a>
     Rédaction complétée à {{ object.conf.edition_progress }}%
      <a class="btn btn-danger pull-right" href="{% url 'confs:delete' object.conf.slug %}"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Supprimer la conférence</a>
{% endblock %}
{% block content %}
<div class="container">

  <div class="row">
    <div class="col-sm-12">

      <h2>{{ object.conf.title}}</h2>
    </div>
  </div>

<!-- Action buttons -->
  <div class="row">
  
    <div class="col-sm-12 ">
	  <legend>Résultat</legend>
	  <strong>Score :</strong> {{object.score}} / {{object.max_score}}<br>
  	  <strong>Temps :</strong> {{object.time_taken }}<br>
  	  <strong>Erreurs :</strong> {{object.nb_errors }}<br>
  	  <strong>Erreurs graves: </strong> {{ object.fatal_errors | length }}<br>
	  <br>
	  {% if object.conf.type == 'DCP' %}
	  <legend>Énoncé</legend><p> {{ object.conf.statement | default:"<i>aucun</i>"}}<p>
	  <legend>Illustrations</legend>
	  {% for image in object.conf.images.all %}
	  <div class="illustrations" id="images_div">
		  <figure>
		  <img src="{% cropped_thumbnail image "cropping" %}">
		  <figcaption>{{ image.caption }}</figcaption>
		  </figure>
	  </div>
	  {% empty %}
	  <i>Aucune</i>
	  {% endfor %}
	  {% endif %}
      <!-- Your Stuff: Custom user template urls -->
    </div>
    <h2>Questions</h2>
   
    {% for t_answer in object.answers.all|dictsort:"question.index" %}
    <div class="well well-white">
	    <h1>{{ t_answer.score }} / {{ t_answer.max_score }}</h1>
	    <legend>Question {{ t_answer.question.index | add:"1" }} {% if not t_answer.question.is_valid %}<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>{% endif %}</legend>
      <div class="col-sm-12">
	      <strong>Énoncé :</strong><p>{{ t_answer.question.question | default:"<i>aucun</i>"}}</p>
      </div>
      {% for image in t_answer.question.images.all %}
      <div class="illustrations" id="images_div">
	      <figure>
	      <img src="{% cropped_thumbnail image "cropping" %}">
	      <figcaption>{{ image.caption }}</figcaption>
	      </figure>
      </div>
      {% endfor %}
      {% for answer in t_answer.question.answers.all %}
      <div class="col-sm-12 {{ answer | is_good:t_answer }}">
	      <strong>Réponse {{ answer.index | to_char }} <i class="fa fa-{% if answer.correct %}check"{% else %}times"{% endif %} aria-hidden="true"></i>:</strong> <p>{{ answer.answer | default:"<i>A compléter</i>" }}</p>
	      <strong>Explication :</strong> <p>{{ answer.explaination | default:"<i>aucune</i>" | youtube | safe }}</p>
	      {% if answer.explaination_image %}
	      <img src="{% cropped_thumbnail answer "cropping" %}">
	      {% endif %}
      </div>
     {% endfor %}
   </div>
   {% endfor %}
  </div>
<!-- End Action buttons -->
</div>
{% endblock content %}

